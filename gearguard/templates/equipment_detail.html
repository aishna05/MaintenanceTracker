{% extends 'base.html' %}
{% load static %}

{% block title %}{{ equipment.name }} - GearGuard{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="detail-container">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-0">
                <i class="fas fa-cog"></i> {{ equipment.name }}
            </h1>
            <p class="text-muted mb-0">{{ equipment.serial_number }}</p>
        </div>
        <div>
            <a href="{% url 'equipment_update' equipment.pk %}" class="btn btn-primary me-2">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{% url 'equipment_list' %}" class="btn btn-outline-light">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Left Column -->
        <div class="col-md-8">
            <!-- Equipment Details -->
            <div class="detail-card">
                <h3 class="mb-4">
                    <i class="fas fa-info-circle"></i> Equipment Details
                </h3>
                
                <div class="info-row">
                    <span class="info-label">Status</span>
                    <span class="info-value">
                        <span class="health-indicator health-{{ equipment.get_health_status }}"></span>
                        {% if equipment.is_scrapped %}
                            <span class="badge bg-danger">Scrapped</span>
                        {% else %}
                            {{ equipment.get_health_status|title }}
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Category</span>
                    <span class="info-value">{{ equipment.get_category_display }}</span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Department</span>
                    <span class="info-value">{{ equipment.get_department_display }}</span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Location</span>
                    <span class="info-value">{{ equipment.location }}</span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Assigned Employee</span>
                    <span class="info-value">
                        {% if equipment.assigned_employee %}
                            {{ equipment.assigned_employee.get_full_name|default:equipment.assigned_employee.username }}
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Maintenance Team</span>
                    <span class="info-value">
                        {% if equipment.maintenance_team %}
                            {{ equipment.maintenance_team.name }}
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Default Technician</span>
                    <span class="info-value">
                        {% if equipment.default_technician %}
                            {{ equipment.default_technician.get_full_name|default:equipment.default_technician.username }}
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Purchase Date</span>
                    <span class="info-value">
                        {% if equipment.purchase_date %}
                            {{ equipment.purchase_date|date:"F d, Y" }}
                        {% else %}
                            <span class="text-muted">Not recorded</span>
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Warranty Expiry</span>
                    <span class="info-value">
                        {% if equipment.warranty_expiry %}
                            {{ equipment.warranty_expiry|date:"F d, Y" }}
                            {% if equipment.warranty_expiry < today %}
                                <span class="badge bg-danger">Expired</span>
                            {% endif %}
                        {% else %}
                            <span class="text-muted">Not recorded</span>
                        {% endif %}
                    </span>
                </div>
                
                {% if equipment.notes %}
                <div class="info-row">
                    <span class="info-label">Notes</span>
                    <span class="info-value">{{ equipment.notes }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Maintenance History -->
            <div class="detail-card">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="mb-0">
                        <i class="fas fa-history"></i> Maintenance History
                    </h3>
                    <a href="{% url 'request_create' %}?equipment={{ equipment.pk }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus"></i> New Request
                    </a>
                </div>
                
                <div class="timeline">
                    {% for request in maintenance_requests %}
                    <div class="timeline-item">
                        <div class="request-history-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">{{ request.subject }}</h6>
                                    <small class="text-muted">
                                        {{ request.get_request_type_display }} | 
                                        Created {{ request.created_at|date:"M d, Y" }}
                                    </small>
                                    <div class="mt-2">
                                        <span class="badge" style="background: {% if request.stage == 'new' %}#ffc107{% elif request.stage == 'in_progress' %}#17a2b8{% elif request.stage == 'repaired' %}#28a745{% else %}#6c757d{% endif %}">
                                            {{ request.get_stage_display }}
                                        </span>
                                        <span class="badge bg-secondary">
                                            {{ request.get_priority_display }}
                                        </span>
                                        {% if request.assigned_to %}
                                        <span class="badge bg-info">
                                            {{ request.assigned_to.get_full_name|default:request.assigned_to.username }}
                                        </span>
                                        {% endif %}
                                        {% if request.duration_hours %}
                                        <span class="badge bg-success">
                                            {{ request.duration_hours }}h
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <a href="{% url 'request_update' request.pk %}" class="btn btn-sm btn-outline-light">
                                    View
                                </a>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-center text-muted py-4">No maintenance history</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Right Column - Smart Buttons & Actions -->
        <div class="col-md-4">
            <!-- Smart Button -->
            <div class="detail-card text-center">
                <h4 class="mb-4">Quick Actions</h4>
                
                <a href="{% url 'request_create' %}?equipment={{ equipment.pk }}" class="smart-button w-100 justify-content-center mb-3">
                    <i class="fas fa-tools fa-2x"></i>
                    <div>
                        <div style="font-size: 1.2rem;">Maintenance</div>
                        <small>Create new request</small>
                    </div>
                    {% if open_requests_count > 0 %}
                    <span class="badge">{{ open_requests_count }}</span>
                    {% endif %}
                </a>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-light" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Details
                    </button>
                    <a href="{% url 'equipment_update' equipment.pk %}" class="btn btn-outline-light">
                        <i class="fas fa-edit"></i> Edit Equipment
                    </a>
                </div>
            </div>

            <!-- Statistics -->
            <div class="detail-card">
                <h5 class="mb-3">
                    <i class="fas fa-chart-bar"></i> Statistics
                </h5>
                
                <div class="info-row">
                    <span class="info-label">Open Requests</span>
                    <span class="info-value">
                        <span class="badge bg-warning">{{ open_requests_count }}</span>
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Total Requests</span>
                    <span class="info-value">{{ maintenance_requests.count }}</span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Completed</span>
                    <span class="info-value">
                        {{ maintenance_requests|filter_by_stage:'repaired'|length }}
                    </span>
                </div>
                
                <div class="info-row">
                    <span class="info-label">Health Score</span>
                    <span class="info-value">
                        <span class="health-indicator health-{{ equipment.get_health_status }}"></span>
                        {{ equipment.get_health_status|title }}
                    </span>
                </div>
            </div>

            <!-- Related Information -->
            <div class="detail-card">
                <h5 class="mb-3">
                    <i class="fas fa-link"></i> Related
                </h5>
                
                {% if equipment.maintenance_team %}
                <div class="mb-3">
                    <a href="{% url 'teams_list' %}" class="btn btn-outline-light w-100">
                        <i class="fas fa-users"></i> View Team
                    </a>
                </div>
                {% endif %}
                
                <div class="mb-3">
                    <a href="{% url 'equipment_list' %}?department={{ equipment.department }}" class="btn btn-outline-light w-100">
                        <i class="fas fa-building"></i> Department Equipment
                    </a>
                </div>
                
                <div>
                    <a href="{% url 'reporting' %}" class="btn btn-outline-light w-100">
                        <i class="fas fa-chart-line"></i> View Reports
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add any JavaScript for interactive features here
</script>
{% endblock %}